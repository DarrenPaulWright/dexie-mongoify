!function(n,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("Dexie"));else if("function"==typeof define&&define.amd)define(["Dexie"],e);else{var r=e("object"==typeof exports?require("Dexie"):n.Dexie);for(var t in r)("object"==typeof exports?exports:n)[t]=r[t]}}(this,function(n){return function(n){function e(t){if(r[t])return r[t].exports;var u=r[t]={exports:{},id:t,loaded:!1};return n[t].call(u.exports,u,u.exports,e),u.loaded=!0,u.exports}var r={};return e.m=n,e.c=r,e.p="",e(0)}([function(n,e,r){var t=r(1),u=r(2),i=r(3),o=r(4),c=r(5),a=r(7),f=function(){},l={$eq:function(n,e){return function(r){return u(r,n)&&r[n]===e}},$gt:function(n,e){return function(r){return u(r,n)&&r[n]>e}},$gte:function(n,e){return function(r){return u(r,n)&&r[n]>=e}},$lt:function(n,e){return function(r){return u(r,n)&&r[n]<e}},$lte:function(n,e){return function(r){return u(r,n)&&r[n]<=e}},$ne:function(n,e){return function(r){return u(r,n)&&r[n]!==e}},$in:function(n,e){return function(r){return u(r,n)&&e.indexOf(r[n])>-1}},$nin:function(n,e){return function(r){return u(r,n)&&-1===e.indexOf(r[n])}},$exists:function(n,e){return function(r){return u(r,n)===e}},$all:function(n,e){return function(r){return u(r,n)&&e.every(function(e){return r[n].indexOf(e)>-1})}},$size:function(n,e){return function(r){return u(r,n)&&r[n].length===e}},$elemMatch:function(n,e){var r=m(n,e);return function(e){return u(e,n)&&e[n].some(function(e){var t={};return t[n]=e,r.every(function(n){return n(t)})})}},$not:function(n,e){var r=m(n,e);return function(e){return!u(e,n)||r.every(function(n){return!n(e)})}}},s={$and:function(n,e){var r=e.map(h).reduce(c);return function(n){return r.every(function(e){return e(n)})}},$or:function(n,e){var r=e.map(h);return function(n){return r.some(function(e){return e.every(function(e){return e(n)})})}},$nor:function(n,e){var r=this.$and(n,e);return function(n){return!r(n)}}},p={$inc:function(n,e){return b(e,function(n,r){u(r,n)&&(r[n]+=e[n])})},$mul:function(n,e){return b(e,function(n,r){u(r,n)&&(r[n]*=e[n])})},$rename:function(n,e){return b(e,function(n,r){var t=r[n];delete r[n],r[e[n]]=t})},$set:function(n,e){return b(e,function(n,r){r[n]=e[n]})},$unset:function(n,e){return b(e,function(n,e){delete e[n]})},$min:function(n,e){return b(e,function(n,r){r[n]=Math.min(r[n],e[n])})},$max:function(n,e){return b(e,function(n,r){r[n]=Math.max(r[n],e[n])})},$addToSet:function(n,e){return b(e,function(n,r){a.checkIsArrayField(r,n)?-1===r[n].indexOf(e[n])&&r[n].push(e[n]):r[n]=[e[n]]})},$pop:function(n,e){return b(e,function(n,r){a.checkIsArrayField(r,n),1===e[n]?r[n].pop():-1===e[n]&&r[n].shift()})},$push:function(n,e){return b(e,function(n,r){a.checkIsArrayField(r,n)?r[n].push(e[n]):r[n]=[e[n]]})},$pullAll:function(n,e){return b(e,function(n,r){a.checkIsArrayField(r,n);var t=e[n];r[n]=r[n].filter(function(n){return-1===t.indexOf(n)})})},$pull:function(n,e){return b(e,function(n,r){a.checkIsArrayField(r,n);var t=e[n],u=a.isPlainValue(t);if(u)r[n]=r[n].filter(function(n){return n!==t});else{var i=m(n,t);r[n]=r[n].filter(function(e){var r={};return r[n]=e,!i.some(function(n){return n(r)})})}})},$slice:function(n,e){return b(e,function(n,r){a.checkIsArrayField(r,n);var t=e[n];if(a.isPlainValue(t))r[n]=a.sliceArray(r[n],t);else{var u=Object.keys(t);r[n]=r[n].map(function(n){return u.reduce(function(n,e){return n[e]=a.sliceArray(n[e],t[e]),n},n)})}})},$sort:function(n,e){return b(e,function(n,r){a.checkIsArrayField(r,n);var t=e[n];if(a.isPlainValue(t))r[n]=r[n].sort(function(n,e){return a.valueComparator(n,e,t)});else{var u=r[n].slice();r[n]=Object.keys(t).reduce(function(n,e){var r=t[e];return u.sort(function(n,t){var u=n[e],i=t[e];return a.valueComparator(u,i,r)})},r[n])}})}},y={query:Object.keys(l),queryLogical:Object.keys(s),update:Object.keys(p)},d=["upsert"],v=["$set","$addToSet","$push"],h=function(n){return Object.keys(n).map(function(e){return m(e,n[e])}).reduce(c)},m=function(n,e){return Object.keys(e).map(function(r){return F({key:n,type:r,value:e[r]})})},O=function(n,e){return e=e||Object.keys(n),function(r){return e.every(function(e){return u(r,e)&&r[e]===n[e]})}},k=function(n,e){return e=e||Object.keys(n),function(r){e.forEach(function(e){u(r,e)&&(r[e]=n[e])})}},b=function(n,e){var r=Object.keys(n);return function(n){r.forEach(function(r){e(r,n)})}},x=function(n,e){var r=Object.keys(n).filter(function(n){var e=u(l,n),r=u(s,n);return!(e||r)}),t=i(n,r),c=v.reduce(function(n,r){var t=e[r];return o(n,t)},{});return o(t,c)},$=function(n,e){var r=-1,t=-1,u=-1;return e.indexedKeys.forEach(function(n,e){n.unique?r=e:"number"==typeof n.value?t=e:n.plain&&(u=e)}),r>-1?e.indexedKeys[r]:t>-1?e.indexedKeys[t]:e.indexedKeys[u]},j=function(n){return n.queryOperators.advanced.map(function(n){return n.operators.map(function(e){return F({type:e,key:n.key,value:n.value[e]})})}).reduce(c)},g=function(n){return n.updateOperators.advanced.map(function(n){return F({type:n.key,key:null,value:n.value})})},q=function(n){var e=j(n);return function(n){return e.every(function(e){return e(n)})}},P=function(n){var e=g(n);return function(n){e.forEach(function(e){e(n)})}},A=function(n){return n.queryOperators.plain.map(function(n){return n.key})},K={primaryKey:function(n,e,r){var t=e.primaryKey.key,u=e.primaryKey.value,i=r.where(t).equals(u);if(e.queryOperators.plain.length>0){var o=O(n,A(e));i.and(o)}if(e.queryOperators.advanced.length>0){var c=q(e);i.and(c)}return i},indexedProp:function(n,e,r){var t,u=$(n,e);if(t=u&&u.plain?r.where(u.key).equals(u.value):r.toCollection(),e.queryOperators.plain.length>0){var i=O(n,A(e));t.and(i)}if(e.queryOperators.advanced.length>0){var o=q(e);t.and(o)}return t},fullScan:function(n,e,r){var t=r.toCollection();if(e.queryOperators.plain.length>0){var u=O(n,A(e));t.and(u)}if(e.queryOperators.advanced.length>0){var i=q(e);t.and(i)}return t}},C=function(n,e){var r=e.updateOperators.plain.length>0,t=e.updateOperators.advanced.length>0;return r&&t?f:r?k(n,e.keys):t?P(e):void 0},I=function(n,e){return{insertedCount:1,insertedId:e.id,ops:[e.item],result:{ok:1,n:1}}},w=function(n,e){var r=e&&e.isUpsert===!0,t=r?0:n,u=r?1:0;return{result:{ok:1,nModified:t},modifiedCount:t,upsertedCount:u,upsertedId:r?e.id:null}},E=function(n){return{result:{ok:1,n:n},deletedCount:n}},V=function(n,e,r){return new t.Promise(function(t,u){n.update(e,r).then(function(u){if(0===u.modifiedCount){var i=x(e,r);return n.insert(i)}t(u)}).then(function(n){if("number"==typeof n.insertedId){var e=w(1,{isUpsert:!0,id:n.insertedId});t(e)}})["catch"](u)})},T=function(n,e,r){var t=B(r),u=C(r,t);return n.find(e).modify(u).then(function(n){return w(n,null)})},F=function(n){var e;return y.query.indexOf(n.type)>-1?e=l:y.queryLogical.indexOf(n.type)>-1?e=s:y.update.indexOf(n.type)>-1&&(e=p),e[n.type](n.key,n.value)},D=function(n,e,r){return e.reduce(r(n,e),{plain:[],advanced:[]})},S=function(n,e){return function(e,r){var t=n[r],u=a.isPlainValue(t),i=y.queryLogical.indexOf(r)>-1;if(u)e.plain.push({key:r,value:t,plain:u});else if(i){var o={};o[r]=t,e.advanced.push({key:r,value:o,plain:u,operators:[r]})}else e.advanced.push({key:r,value:t,plain:u,operators:Object.keys(t).filter(function(n){return y.query.indexOf(n)>-1})});return e}},M=function(n,e){return function(e,r){var t=n[r],u=a.isPlainValue(t);return u?e.plain.push({key:r,value:t,plain:u}):e.advanced.push({key:r,value:t,plain:u}),e}},L=function(n,e){return D(n,e,S)},U=function(n,e){return D(n,e,M)},z=function(n,e){var r=e.primKey.keyPath,t=n[r],u=typeof t,i="number"===u||"string"===u;return i?{key:r,value:t}:{key:!1}},W=function(n,e,r){return r.indexes.filter(function(n){return e.indexOf(n.keyPath)>-1}).map(function(e){var r=e.keyPath;return{key:r,value:n[r],unique:e.unique,plain:a.isPlainValue(n[r])}})},Y=function(n,e){var r=Object.keys(n);return{keys:r,queryOperators:L(n,r),primaryKey:z(n,e),indexedKeys:W(n,r,e)}},B=function(n){var e=Object.keys(n);return{keys:e,updateOperators:U(n,e)}},G=function(n){return a.isEmptyValue(n)?{}:i(n,d)},H=function(n,e){var r,t=Y(n,e);return r=t.primaryKey.key?"primaryKey":t.indexedKeys.length>0?"indexedProp":"fullScan",{queryAnalysis:t,execute:K[r]}},J=function(n,e,r,t){var u=t.upsert===!0?V:T;return u(n,e,r)},N=function(n,e){if(a.isEmptyValue(e))return n.toCollection();var r=H(e,n.schema);return r.execute(e,r.queryAnalysis,n)},Q=function(n,e){var r=n.schema.primKey.keyPath;return n.add(e).then(function(n){var t=i(e,Object.keys(e));return t[r]=n,I(1,{item:e,id:n})})},R=function(n,e){return N(n,e)["delete"]().then(E)},X=function(n){return n.toCollection()["delete"]().then(E)};Dexie.addons.push(function(n){Dexie.prototype.collection=function(e){return n.table(e)},n.Table.prototype.count=function(n){var e=a.isEmptyValue(n),r=e?this.toCollection():N(this,n);return r.count()},n.Table.prototype.find=function(n){return N(this,n)},n.Table.prototype.findOne=function(n){return N(this,n).first()},n.Table.prototype.insert=function(n){return Q(this,n)},n.Table.prototype.remove=function(n){return R(this,n)},n.Table.prototype.drop=function(){return X(this)},n.WriteableTable.prototype.update=function e(n,e,r){var t=G(r);return J(this,n,e,t)}})},function(e,r){e.exports=n},function(n,e){var r=Object.prototype.hasOwnProperty;n.exports=function(n,e){return r.call(n,e)}},function(n,e){n.exports=function(n,e){return n=n||{},"string"==typeof e&&(e=e.split(/ +/)),e.reduce(function(e,r){return null==n[r]?e:(e[r]=n[r],e)},{})}},function(n,e){"use strict";function r(n){if(null===n||void 0===n)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(n)}var t=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable;n.exports=Object.assign||function(n,e){for(var i,o,c=r(n),a=1;a<arguments.length;a++){i=Object(arguments[a]);for(var f in i)t.call(i,f)&&(c[f]=i[f]);if(Object.getOwnPropertySymbols){o=Object.getOwnPropertySymbols(i);for(var l=0;l<o.length;l++)u.call(i,o[l])&&(c[o[l]]=i[o[l]])}}return c}},function(n,e,r){"use strict";function t(n,e){return n.concat(e)}var u=r(6);n.exports=u(t)},function(n,e){"use strict";function r(n,e){var r=function(){return arguments.length>1?n.call(e,arguments[0],arguments[1]):n.bind(e,arguments[0])};return r.uncurry=function(){return n},r}n.exports=r},function(n,e,r){var t=r(2);n.exports={isEmptyValue:function(n){var e="object"==typeof n&&null!==n,r=!(e&&n);return r||0===Object.keys(n).length},isPlainValue:function(n){var e=typeof n;return"number"===e||"string"===e||"boolean"===e},checkIsArrayField:function(n,e){var r=t(n,e),u=Array.isArray(n[e]);if(r&&!u)throw new Error("You can't use array update operator on non-array field");return r},sliceArray:function(n,e){return e>=0?n.slice(0,e):n.slice(e)},valueComparator:function(n,e,r){return 1===r?n>e:e>n}}}])});