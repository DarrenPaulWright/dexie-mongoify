(function(d){var f={$eq:function(c,a){return function(b){return b.hasOwnProperty(c)&&b[c]===a}},$gt:function(c,a){return function(b){return b.hasOwnProperty(c)&&b[c]>a}},$gte:function(c,a){return function(b){return b.hasOwnProperty(c)&&b[c]>=a}},$lt:function(c,a){return function(b){return b.hasOwnProperty(c)&&b[c]<a}},$lte:function(c,a){return function(b){return b.hasOwnProperty(c)&&b[c]<=a}},$ne:function(c,a){return function(b){return b.hasOwnProperty(c)&&b[c]!==a}},$in:function(c,a){return function(b){return b.hasOwnProperty(c)&&
-1<a.indexOf(b[c])}},$nin:function(c,a){return function(b){return b.hasOwnProperty(c)&&-1===a.indexOf(b[c])}},$exists:function(c,a){return function(b){return b.hasOwnProperty(c)===a}},$all:function(c,a){return function(b){return b.hasOwnProperty(c)&&a.every(function(a){return-1<b[c].indexOf(a)})}},$size:function(c,a){return function(b){return b.hasOwnProperty(c)&&b[c].length===a}},$elemMatch:function(c,a){var b=m(c,a);return function(a){return a.hasOwnProperty(c)&&a[c].some(function(a){var h={};h[c]=
a;return b.every(function(b){return b(h)})})}},$not:function(c,a){var b=m(c,a);return function(a){return!a.hasOwnProperty(c)||b.every(function(b){return!b(a)})}}},l={$and:function(c,a){var b=a.map(u).reduce(d.concat);return function(a){return b.every(function(b){return b(a)})}},$or:function(c,a){var b=a.map(u);return function(a){return b.some(function(b){return b.every(function(b){return b(a)})})}},$nor:function(c,a){var b=this.$and(c,a);return function(a){return!b(a)}}},n={$inc:function(c,a){return g(a,
function(b,c){c.hasOwnProperty(b)&&(c[b]+=a[b])})},$mul:function(c,a){return g(a,function(b,c){c.hasOwnProperty(b)&&(c[b]*=a[b])})},$rename:function(c,a){return g(a,function(b,c){var e=c[b];delete c[b];c[a[b]]=e})},$set:function(c,a){return g(a,function(b,c){c[b]=a[b]})},$unset:function(c,a){return g(a,function(b,a){delete a[b]})},$min:function(c,a){return g(a,function(b,c){c[b]=Math.min(c[b],a[b])})},$max:function(c,a){return g(a,function(b,c){c[b]=Math.max(c[b],a[b])})},$addToSet:function(c,a){return g(a,
function(b,c){d.checkIsArrayField(c,b)?-1===c[b].indexOf(a[b])&&c[b].push(a[b]):c[b]=[a[b]]})},$pop:function(c,a){return g(a,function(b,c){d.checkIsArrayField(c,b);1===a[b]?c[b].pop():-1===a[b]&&c[b].shift()})},$push:function(c,a){return g(a,function(b,c){d.checkIsArrayField(c,b)?c[b].push(a[b]):c[b]=[a[b]]})},$pullAll:function(c,a){return g(a,function(b,c){d.checkIsArrayField(c,b);var e=a[b];c[b]=c[b].filter(function(b){return-1===e.indexOf(b)})})},$pull:function(c,a){return g(a,function(b,c){d.checkIsArrayField(c,
b);var e=a[b];if(d.isPlainValue(e))c[b]=c[b].filter(function(b){return b!==e});else{var k=m(b,e);c[b]=c[b].filter(function(a){var c={};c[b]=a;return!k.some(function(b){return b(c)})})}})},$slice:function(c,a){return g(a,function(b,c){d.checkIsArrayField(c,b);var e=a[b];if(d.isPlainValue(e))c[b]=d.sliceArray(c[b],e);else{var k=Object.keys(e);c[b]=c[b].map(function(b){return k.reduce(function(b,a){b[a]=d.sliceArray(b[a],e[a]);return b},b)})}})},$sort:function(c,a){return g(a,function(b,c){d.checkIsArrayField(c,
b);var e=a[b];if(d.isPlainValue(e))c[b]=c[b].sort(function(b,a){return d.valueComparator(b,a,e)});else{var k=c[b].slice();c[b]=Object.keys(e).reduce(function(b,a){var c=e[a];return k.sort(function(b,h){return d.valueComparator(b[a],h[a],c)})},c[b])}})}},v=Object.keys(f),w=Object.keys(l),x=Object.keys(n),u=function(c){return Object.keys(c).map(function(a){return m(a,c[a])}).reduce(d.concat)},m=function(c,a){return Object.keys(a).map(function(b){return p({key:c,type:b,value:a[b]})})},q=function(c,a){a=
a||Object.keys(c);return function(b){return a.every(function(a){return b.hasOwnProperty(a)&&b[a]===c[a]})}},y=function(c,a){a=a||Object.keys(c);return function(b){a.forEach(function(a){b.hasOwnProperty(a)&&(b[a]=c[a])})}},g=function(c,a){var b=Object.keys(c);return function(c){b.forEach(function(b){a(b,c)})}},z=function(c,a){var b=-1,h=-1,d=-1;a.indexedKeys.forEach(function(a,c){a.unique?b=c:"number"===typeof a.value?h=c:a.plain&&(d=c)});return-1<b?a.indexedKeys[b]:-1<h?a.indexedKeys[h]:a.indexedKeys[d]},
A=function(c){return c.queryOperators.advanced.map(function(a){return a.operators.map(function(b){return p({type:b,key:a.key,value:a.value[b]})})}).reduce(d.concat)},B=function(c){return c.updateOperators.advanced.map(function(a){return p({type:a.key,key:null,value:a.value})})},r=function(c){var a=A(c);return function(b){return a.every(function(a){return a(b)})}},C=function(c){var a=B(c);return function(b){a.forEach(function(a){a(b)})}},t=function(c){return c.queryOperators.plain.map(function(a){return a.key})},
D={primaryKey:function(c,a,b){var d=a.primaryKey.value;b=b.where(a.primaryKey.key).equals(d);0<a.queryOperators.plain.length&&(c=q(c,t(a)),b.and(c));0<a.queryOperators.advanced.length&&(a=r(a),b.and(a));return b},indexedProp:function(c,a,b){var d=z(c,a);b=d&&d.plain?b.where(d.key).equals(d.value):b.toCollection();0<a.queryOperators.plain.length&&(c=q(c,t(a)),b.and(c));0<a.queryOperators.advanced.length&&(a=r(a),b.and(a));return b},fullScan:function(c,a,b){b=b.toCollection();0<a.queryOperators.plain.length&&
(c=q(c,t(a)),b.and(c));0<a.queryOperators.advanced.length&&(a=r(a),b.and(a));return b}},E=function(c,a){var b=0<a.updateOperators.plain.length,d=0<a.updateOperators.advanced.length;if(b&&d)return function(){};if(b)return y(c,a.keys);if(d)return C(a)},p=function(c){var a;-1<v.indexOf(c.type)?a=f:-1<w.indexOf(c.type)?a=l:-1<x.indexOf(c.type)&&(a=n);return a[c.type](c.key,c.value)},F=function(c,a){return function(b,a){var e=c[a],k=d.isPlainValue(e),f=-1<w.indexOf(a);k?b.plain.push({key:a,value:e,plain:k}):
f?(f={},f[a]=e,b.advanced.push({key:a,value:f,plain:k,operators:[a]})):b.advanced.push({key:a,value:e,plain:k,operators:Object.keys(e).filter(function(a){return-1<v.indexOf(a)})});return b}},G=function(c,a){return function(a,h){var e=c[h],f=d.isPlainValue(e);f?a.plain.push({key:h,value:e,plain:f}):a.advanced.push({key:h,value:e,plain:f});return a}},H=function(c,a,b){return b.indexes.filter(function(b){return-1<a.indexOf(b.keyPath)}).map(function(a){var b=a.keyPath;return{key:b,value:c[b],unique:a.unique,
plain:d.isPlainValue(c[b])}})};Dexie.addons.push(function(c){Dexie.prototype.collection=function(a){return c.table(a)};c.Table.prototype.count=function(a){return(d.isEmptyValue(a)?this.toCollection():this.find(a)).count()};c.Table.prototype.find=function(a){if(d.isEmptyValue(a))return this.toCollection();var b;b=this.schema;var c=Object.keys(a),e=c.reduce(F(a,c),{plain:[],advanced:[]}),f=b.primKey.keyPath,g=a[f],l=typeof g;b={keys:c,queryOperators:e,primaryKey:"number"===l||"string"===l?{key:f,value:g}:
{key:!1},indexedKeys:H(a,c,b)};b={queryAnalysis:b,execute:D[b.primaryKey.key?"primaryKey":0<b.indexedKeys.length?"indexedProp":"fullScan"]};return b.execute(a,b.queryAnalysis,this)};c.Table.prototype.findOne=function(a){return this.find(a).first()};c.Table.prototype.insert=function(a){return this.add(a)};c.Table.prototype.remove=function(a){return this.find(a)["delete"]()};c.Table.prototype.drop=function(){return this.toCollection()["delete"]()};c.WriteableTable.prototype.update=function(a,b){var c=
d.isEmptyValue(a)?this.toCollection():this.find(a),e;e=Object.keys(b);e={keys:e,updateOperators:e.reduce(G(b,e),{plain:[],advanced:[]})};e=E(b,e);return c.modify(e)}})})({isEmptyValue:function(d){return!("object"===typeof d&&null!==d&&d)||0===Object.keys(d).length},isPlainValue:function(d){d=typeof d;return"number"===d||"string"===d||"boolean"===d},checkIsArrayField:function(d,f){var l=d.hasOwnProperty(f),n=Array.isArray(d[f]);if(l&&!n)throw Error("You can't use array update operator on non-array field");
return l},concat:function(d,f){return d.concat(f)},sliceArray:function(d,f){return 0<=f?d.slice(0,f):d.slice(f)},valueComparator:function(d,f,l){return 1===l?d>f:d<f}});
